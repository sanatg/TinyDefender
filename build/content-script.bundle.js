!function(){"use strict";const e={attribute:/\[\s*(?:(?<namespace>\*|[-\w]*)\|)?(?<name>[-\w\u{0080}-\u{FFFF}]+)\s*(?:(?<operator>\W?=)\s*(?<value>.+?)\s*(?<caseSensitive>[iIsS])?\s*)?\]/gu,id:/#(?<name>(?:[-\w\u{0080}-\u{FFFF}]|\\.)+)/gu,class:/\.(?<name>(?:[-\w\u{0080}-\u{FFFF}]|\\.)+)/gu,comma:/\s*,\s*/g,combinator:/\s*[\s>+~]\s*/g,"pseudo-element":/::(?<name>[-\w\u{0080}-\u{FFFF}]+)(?:\((?:¶*)\))?/gu,"pseudo-class":/:(?<name>[-\w\u{0080}-\u{FFFF}]+)(?:\((?<argument>¶*)\))?/gu,type:/(?:(?<namespace>\*|[-\w]*)\|)?(?<name>[-\w\u{0080}-\u{FFFF}]+)|\*/gu},t=new Set(["pseudo-class","pseudo-element"]);new Set([...t,"attribute"]);const n=Object.assign({},e);function s(e,t){if("id"===t.type||"class"===t.type||"type"===t.type||"attribute"===t.type)return e.matches(t.content);if("list"===t.type)return t.list.some((t=>s(e,t)));if("compound"===t.type)return t.compound.every((t=>s(e,t)));if("pseudo-class"===t.type){if("has"===t.name||"if"===t.name)return void 0!==t.subtree&&0!==o(e,t.subtree).length;if("not"===t.name)return void 0!==t.subtree&&!1===s(e,t.subtree);if("has-text"===t.name){const{argument:n}=t;if(void 0===n)return!1;const s=e.textContent;return null!==s&&function(e,t){if(e.startsWith("/")&&(e.endsWith("/")||e.endsWith("/i"))){let n=!0;return(e=e.slice(1)).endsWith("/")?e=e.slice(0,-1):(e=e.slice(0,-2),n=!1),new RegExp(e,!1===n?"i":void 0).test(t)}return t.includes(e)}(n,s)}if("min-text-length"===t.name){const n=Number(t.argument);if(Number.isNaN(n)||n<0)return!1;const s=e.textContent;return null!==s&&s.length>=n}}return!1}function o(e,t){const n=[];if("id"===t.type||"class"===t.type||"type"===t.type||"attribute"===t.type)n.push(...e.querySelectorAll(t.content));else if("list"===t.type)for(const s of t.list)n.push(...o(e,s));else if("compound"===t.type)0!==t.compound.length&&n.push(...o(e,t.compound[0]).filter((e=>t.compound.slice(1).every((t=>s(e,t))))));else if("complex"===t.type){const r=void 0===t.left?[e]:o(e,t.left);if(" "===t.combinator)for(const e of r)n.push(...o(e,t.right));else if(">"===t.combinator)for(const e of r)for(const o of e.children)!0===s(o,t.right)&&n.push(o);else if("~"===t.combinator)for(const e of r){let o=e;for(;null!==(o=o.nextElementSibling);)!0===s(o,t.right)&&n.push(o)}else if("+"===t.combinator)for(const e of r){const o=e.nextElementSibling;null!==o&&!0===s(o,t.right)&&n.push(o)}}else if("pseudo-class"===t.type)for(const o of e.querySelectorAll("*"))!0===s(o,t)&&n.push(o);return n}var r;n["pseudo-element"]=RegExp(e["pseudo-element"].source.replace("(?<argument>¶*)","(?<argument>.*?)"),"gu"),n["pseudo-class"]=RegExp(e["pseudo-class"].source.replace("(?<argument>¶*)","(?<argument>.*)"),"gu"),function(e){e[e.Normal=0]="Normal",e[e.Extended=1]="Extended",e[e.Invalid=2]="Invalid"}(r||(r={}));const i="cliqz-adblocker-script",c=new Set(["br","head","link","meta","script","style","s"]);function u(e){return 1===e.nodeType}class l{constructor(e){this.cb=e,this.knownIds=new Set,this.knownHrefs=new Set,this.knownClasses=new Set,this.observer=null}queryAll(e){this.cb({type:"elements",elements:[e.document.documentElement]}),this.handleUpdatedNodes([e.document.documentElement])}start(e){null===this.observer&&void 0!==e.MutationObserver&&(this.observer=new e.MutationObserver((e=>{this.handleUpdatedNodes(function(e){const t=[];for(const n of e)if("attributes"===n.type)u(n.target)&&t.push(n.target);else if("childList"===n.type)for(const e of n.addedNodes)u(e)&&e.id!==i&&t.push(e);return t}(e))})),this.observer.observe(e.document.documentElement,{attributes:!0,attributeFilter:["class","id","href"],childList:!0,subtree:!0}))}stop(){null!==this.observer&&(this.observer.disconnect(),this.observer=null)}handleNewFeatures({hrefs:e,ids:t,classes:n}){const s=[],o=[],r=[];for(const e of t)!1===this.knownIds.has(e)&&(s.push(e),this.knownIds.add(e));for(const e of n)!1===this.knownClasses.has(e)&&(o.push(e),this.knownClasses.add(e));for(const t of e)!1===this.knownHrefs.has(t)&&(r.push(t),this.knownHrefs.add(t));return(0!==s.length||0!==o.length||0!==r.length)&&(this.cb({type:"features",classes:o,hrefs:r,ids:s}),!0)}handleUpdatedNodes(e){return 0!==e.length&&(this.cb({type:"elements",elements:e.filter((e=>!1===c.has(e.nodeName.toLowerCase())))}),this.handleNewFeatures(function(e){const t=new Set(["br","head","link","meta","script","style","s"]),n=new Set,s=new Set,o=new Set;for(const r of e)for(const e of[r,...r.querySelectorAll("[id],[class],[href]")]){if(t.has(e.nodeName.toLowerCase()))continue;const r=e.id;r&&o.add(r);const i=e.classList;if(i)for(const e of i)n.add(e);const c=e.getAttribute("href");"string"==typeof c&&s.add(c)}return{classes:Array.from(n),hrefs:Array.from(s),ids:Array.from(o)}}(e)))}}function a(e,t){const n=t.createElement("script");n.type="text/javascript",n.id=i,n.async=!1,n.appendChild(t.createTextNode(function(e){return`try{${e}}catch(c){}!function(){var c=document.currentScript,e=c&&c.parentNode;e&&e.removeChild(c)}();`}(e)));const s=t.head||t.documentElement;null!==s&&s.appendChild(n)}let d=!0,f=null,m=null;const h=new Set,p=[],b=new Map;function g(){null!==f&&(f.stop(),f=null)}function w(e){return new Promise((t=>{chrome.runtime.sendMessage(Object.assign({action:"getCosmeticsFilters"},e),(e=>{void 0!==e&&t(e)}))}))}function v(e,t,n){var s;const r=null===(s=n.get(e))||void 0===s?void 0:s.get(t);if(void 0!==r)return r;const i=new Set(o(e,t.ast));if(void 0!==t.attribute){let s=n.get(e);void 0===s&&(s=new Map,n.set(e,s));let o=s.get(t);void 0===o&&(o=new Set,s.set(t,o));for(const e of i)o.add(e)}return i}function y(e){if(0!==p.length&&!h.has(window.document.documentElement)){for(const t of e){if(t===window.document.documentElement){h.clear(),h.add(t);break}h.add(t)}null===m&&(m=setTimeout((()=>{m=null,function(){if(0===h.size||0===p.length)return;const e=new Map,t=new Map,n=[...h].filter((e=>!0===e.isConnected));h.clear();for(const s of n)for(const n of p)for(const o of v(s,n,e))!0===n.remove?(o.textContent="",o.remove()):void 0!==n.attribute&&!1===b.has(o)&&t.set(o,{selector:n,root:s});for(const[e,{selector:n,root:s}]of t.entries())void 0!==n.attribute&&(e.setAttribute(n.attribute,""),b.set(e,{selector:n,root:s}));for(const[t,{selector:n,root:s}]of[...b.entries()])void 0!==n.attribute&&(!1!==s.isConnected&&!1!==t.isConnected&&!1!==v(s,n,e).has(t)||(b.delete(t),t.removeAttribute(n.attribute)))}()}),1e3))}}function F(e,{active:t,scripts:n,extended:s}){if(!1===t)return d=!1,void g();d=!0,n&&setTimeout((()=>{for(const t of n)a(t,e.document)}),0),s&&s.length>0&&(p.push(...s),y([e.document.documentElement]))}!function(e,t=!0,n=w){n({lifecycle:"start",ids:[],classes:[],hrefs:[]}).then((t=>F(e,t))),e.addEventListener("DOMContentLoaded",(()=>{f=new l((t=>{"elements"===t.type?0!==t.elements.length&&y(t.elements):n(Object.assign(Object.assign({},t),{lifecycle:"dom-update"})).then((t=>F(e,t)))})),f.queryAll(e),d&&t&&f.start(e)}),{once:!0,passive:!0}),e.addEventListener("unload",g,{once:!0,passive:!0})}(window,!0)}();
//# sourceMappingURL=content-script.bundle.js.map
